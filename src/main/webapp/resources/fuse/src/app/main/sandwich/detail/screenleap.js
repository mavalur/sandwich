function Screenleap(){var bg=5322;var P=5327;var bz=3000;var az=1000;this.DISABLE_CUSTOM_PROTOCOL_AUTO_START=-1;var W=navigator.userAgent.toLowerCase();this.COOKIE_APP_INSTALLED="__ai";this.COOKIE_API_APP_INSTALLED="__aa";this.COOKIE_FORCE_NEW_INSTALLATION="__ni";this.isMac=W.indexOf("mac")>-1;this.isWin=W.indexOf("windows ")>-1;this.isChrome=W.indexOf("chrome")>-1;this.isFirefox=W.indexOf("firefox")>-1;this.isSafari=W.toLowerCase().indexOf("safari")!=-1&&!this.isChrome;this.isMSIE=W.indexOf("msie")>-1||W.indexOf("trident")>-1;this.isMSIE8=navigator.appVersion.indexOf("MSIE 8")>-1;this.isWin32=W.indexOf("win64")==-1&&W.indexOf("wow64")==-1;this.isWin64=!this.isWin32;this.hasDotNetFramework=W.indexOf(".net")!=-1;var aB=null;var f=this.isSafari?W.substring(W.indexOf("version")+8,W.indexOf(" safari")):null;var q=this.isSafari?f.split("."):null;var ab=this.isSafari&&(q.length>=3&&q[0]>=6&&q[2]>=3||q.length>=2&&q[0]>=6&&q[1]>=1||q.length>=1&&q[0]>=7);var bb=this.isMac?parseFloat(W.substring(W.indexOf("mac os x")+9,W.indexOf(")")).replace(/_/g,".").replace(";","").replace(")","")):null;var d=W.indexOf("trident")>-1;var J=Error;J.prototype.getStackTrace=function(){var bA=Array.prototype.slice.call(arguments,0);var bB=this.lineNumber?"line: "+this.lineNumber:"stack: "+this.stack;console.log.apply(console,bA.concat([bB]))};var aq={};aq.log=typeof console!="undefined"&&typeof console.log.bind!="undefined"?console.log.bind(console):typeof console!="undefined"&&typeof console.log!="undefined"?console.log:function(){};this.log=aq;var w=[];var aA=null;var bd=null;var A="hpcipbhehomfgjbgnajdhiahhdeeffbg";var aJ="";var V=null;var a=false;var aM=null;var aN=null;var bv=null;var z=null;var X=null;var aw=null;var aV=2000;var s=false;var Z=false;var G=20000;var aK=12000;var ay=null;var aW=null;var am=false;var p=null;var F=null;var aX=null;var a9=false;var U=null;var a6="API";var ai=null;var l=null;var aC="";var aR="";var ar;var c="";var aE=null;var bx=null;var g=null;var aH=null;var a7=null;var j=null;var br=null;var O=function(){aq.log("Reset share session");bu();p=null;F=null;aX=null;a9=false;U=null;ai=null;l=null;V=null;a=false;aM=null;aN=null;bv=null;z=null;X=null;aV=2000;aw=null;aK=12000;ay=null;aW=false;ag();aE=null;bx=null;g=null;aH=null;j=null;a7=null;br=null};this.onScreenShareStart=function(){alert("Your screen is now shared.")};this.onPresenterConnect=function(){};this.onScreenShareEnd=function(){alert("Screen share ended.")};this.onViewerConnect=function(bB,bA){};this.onViewerDisconnect=function(bB,bA){};this.onPause=function(){};this.onResume=function(){};this.error=function(bC,bA,bB){if(typeof bB=="undefined"){alert("Error during "+bC+". "+bA)}else{if(bB.status){alert("Error during "+bC+", status code: "+bB.status)}else{if(bB.message){alert("Error during "+bC+": "+bB.message)}else{alert("Error during "+bC+". "+bA)}}}};this.setOptions=function(bA){if(typeof bA!="undefined"){if(typeof bA.webServerBaseUrl!="undefined"){aA=bA.webServerBaseUrl}if(typeof bA.presenterAppType!="undefined"){V=bA.presenterAppType}if(typeof bA.browserMessageUrl!="undefined"){ai=bA.browserMessageUrl}if(typeof bA.startingWindowTitle!="undefined"){bd=bA.startingWindowTitle}if(typeof bA.appInstalled!="undefined"){Z=bA.appInstalled}if(typeof bA.serverEnv!="undefined"){aJ=bA.serverEnv;if(aJ=="dev"||aJ=="stage"){this.downloadForCustomProtocol=function(){a6="SCREENLEAP";r(aD()+t({origin:"SCREENLEAP"}))};this.startUsingCustomProtocolHandler=function(bC,bB,bD){N(bC,bB,bD)}}}if(typeof bA.chromeAppId!="undefined"){A=bA.chromeAppId}if(typeof bA.downloadNativeTimeout!="undefined"){aV=bA.downloadNativeTimeout}if(typeof bA.origin!="undefined"){a6=bA.origin}if(typeof bA.showScreenShareStartErrorDelay!="undefined"){aK=bA.showScreenShareStartErrorDelay}if(typeof bA.delayAfterDownloadBeforeCallingCustomProtocolHandler!="undefined"){G=bA.delayAfterDownloadBeforeCallingCustomProtocolHandler}if(typeof bA.forceDownload!="undefined"){am=bA.forceDownload}if(typeof bA.setHooks!="undefined"){bA.setHooks({copyLink:bk,copyShareCode:K,copyInstructions:ah,enableWebRTC:b,disableWebRTC:C,getWebRTCFrame:a1,forceSendEntireImage:au})}if(bA.presenterAppType&&aJ!="dev"&&aJ!="stage"){aq.log=function(bB){w[w.length]=bB}}}};this.getUseCustomProtocol=function(){return this.isMac||this.isWin};this.useClickOnce=function(){return a6=="API"&&this.isMSIE&&this.hasDotNetFramework&&!this.getUseCustomProtocol()};this.isActiveXFilteringEnabled=function(){if(screenleap.isMSIE){try{return window.external.msActiveXFilteringEnabled()}catch(bA){return false}}return false};this.isBrowserSupportedForExtension=function(){return this.isChrome||this.isFirefox||ab};this.isBrowserSupportedForNative=function(){return !(this.isWin&&this.isMSIE&&!d)};this.isOSSupportedForNative=function(){return this.isWin||(this.isMac&&(bb>10.5||bb<10.2))};this.getDefaultPresenterAppType=function(){return screenleap.isMac||screenleap.isWin?"NATIVE":screenleap.isChrome?"EXTENSION":"APPLET"};this.isAppInstalled=function(){return Z||ap(a6=="API"?screenleap.COOKIE_API_APP_INSTALLED:screenleap.COOKIE_APP_INSTALLED)=="true"};this.requiresUserGestureInitiatedDownload=function(bA){return(!bA||bA=="NATIVE")&&screenleap.isMSIE8&&screenleap.getUseCustomProtocol()&&!screenleap.isAppInstalled()};this.checkIsExtensionInstalled=function(bA,bC){if(this.isChrome){var bB=new Image();bB.onload=function(){if(typeof bA=="function"){bA()}};bB.onerror=function(){if(typeof bC=="function"){bC()}};try{bB.src="chrome-extension://"+A+"/screenleap_icon_16_16.png"}catch(bD){this.error("checkIsExtensionInstalled","Error checking extension installation.",bD);if(typeof bC=="function"){bC()}}}else{this.checkIsExtensionEnabled(bA,bC)}};this.checkIsExtensionEnabled=function(bA,bC,bE,bB){if(!bE){bE=5}if(!bB){bB=1}var bD=R();if(bD&&bD.getAttribute("installed")){if(typeof bA=="function"){bA()}}else{if(bB<bE){setTimeout(function(){screenleap.checkIsExtensionEnabled(bA,bC,bE,bB+1)},1000)}else{if(typeof bC=="function"){bC()}}}};this.installExtension=function(bA,bB,bC){if(this.isBrowserSupportedForExtension()){if(this.isChrome){if(!bC){bC=window.location.href}v(aD()+"/install-extension?redirectUrl="+bC);bc(bA)}else{if(this.isFirefox){try{InstallTrigger.install({Screenleap:{URL:aD()+"/ext/screenleap"+at()+".xpi"}});bc(bA,bB)}catch(bD){if(typeof bB=="function"){bB("Unexpected supported browser type.")}else{bt("installExtension","Unexpected supported browser type.")}}}else{if(this.isSafari){v(aD()+"/ext/screenleap"+at()+".safariextz");bc(bA)}else{if(typeof bB=="function"){bB("Unexpected supported browser type.")}else{bt("installExtension","Unexpected supported browser type.")}}}}}else{if(typeof bB=="function"){bB("The extension is only available in Chrome, Firefox and some versions of Safari.")}else{bt("installExtension","The extension is only available in Chrome, Firefox and some versions of Safari.")}}};var a5=function(){return !s&&ap(screenleap.COOKIE_FORCE_NEW_INSTALLATION)=="true"};var L=function(){return aM!=null};function bo(bA){if(bA&&typeof bA.nativeDownloadStarting=="function"){aE=bA.nativeDownloadStarting}if(bA&&typeof bA.downloadStarting=="function"){aE=bA.downloadStarting}if(bA&&typeof bA.localWebServerStartFailed=="function"){g=bA.localWebServerStartFailed}if(bA&&typeof bA.screenShareStarting=="function"){aH=bA.screenShareStarting}if(bA&&typeof bA.appConnectionFailed=="function"){a7=bA.appConnectionFailed}if(bA&&typeof bA.screenShareStartError=="function"){j=bA.screenShareStartError}if(bA&&typeof bA.appSwitchoverCompleted=="function"){br=bA.appSwitchoverCompleted}}this.startSharing=function(bB,bF,bD,bC){aq.log("Starting share with app type "+bB);if(bB&&bB=="DEFAULT"){if(this.isMac){bB="NATIVE"}else{bB="APPLET"}}if(!bB||!e(bB)){bt("startSharing","Invalid presenterAppType: "+bB);return}if(bF&&!bF.screenShareCode){bt("startSharing","Missing mandatory screen share data.");return}if(bF&&bF.screenShareCode&&!be(bF.screenShareCode)){bt("startSharing","Screen share code is not valid: "+bF.screenShareCode);return}else{if(bB=="NATIVE"){if(!bx&&(!bF.presenterParams||!bF.screenShareCode)){bt("startSharing","Missing required information.");return}else{if(!aj()){return}}}else{if(bB=="EXTENSION"){if(!bF.screenShareCode){bt("startSharing","Missing required information.");return}else{if(!this.isBrowserSupportedForExtension()){bt("startSharing","This browser is not supported for the sharing extension.");return}}}else{if(bB=="APPLET"){if(!bF.appletHtml){bt("startSharing","Missing required information.");return}}}}}O();V=bB;if(bF){by(bF)}bo(bD);var bE=bD?bD.redirectUrl:null;var bA=bD?bD.waitingForSafariExtensionToInstall:false;if(bC){this.setOptions(bC)}if(V=="EXTENSION"){if(bF.startedFromApp){bf("startSharing");Y();T(new Date().getTime())}else{this.checkIsExtensionEnabled(function(){ba("share",bF);u()},function(){if(bA){}else{if(aJ=="dev"&&!this.isSafari){alert("Please install the extension before starting an extension share in dev mode")}else{screenleap.installExtension(function(){ba("share",bF)},function(){bt("startSharing","Unable to install screen sharing extension.")},bE)}}})}}else{if(V=="NATIVE"){a2(bF)}else{if(V=="APPLET"){R().innerHTML=bF.appletHtml}}}};this.startAppUsingCustomProtocolHandler=function(){N(F,aX,a9);return false};this.downloadAndStartNativeApp=function(){am=true;if(p){bn(p)}return false};this.getPresenterAppType=function(){return V};this.getScreenShareCode=function(){return F};this.getViewerUrl=function(){return U};this.isScreenShareStarted=function(){return bv!=null};this.isScreenShareStopped=function(){return F==null};this.stopSharing=function(){if(!V){this.error("stopSharing","Invalid share state.")}else{if(V=="NATIVE"||V=="APPLET"){bl(1,false)}else{if(V=="EXTENSION"){ba("stop");this.endScreenShare({message:"API_CALL"})}}}};this.pauseSharing=function(){if(V=="EXTENSION"){bt("pauseSharing","The pause call has not ben implemented for the browser extension.")}else{if(a){aY("pa",null,function(bA){bt("pause","Error processing pause request",bA)})}else{x("/pause/"+F,null,function(){aY("pa",null,function(bA){bt("pause","Error processing pause request",bA)})})}}};this.resumeSharing=function(){if(V=="EXTENSION"){bt("resumeSharing","The resume call has not been implemented for the browser extension.")}else{if(a){aY("rr",null,function(bA){bt("resume","Error processing resume request",bA)})}else{x("/resume/"+F,null,function(){aY("rr",null,function(bA){bt("resume","Error processing resume request",bA)})})}}};this.startRecording=function(bA,bB){if(l){aY("rt",bA,function(bC){if(bB){bB()}bt("startRecording","Error processing start recording request",bC)})}else{screenleap.error("startRecording","Recording has not been enabled for the screen share.",{})}};this.pauseRecording=function(bA,bB){if(l){aY("rs",bA,function(bC){if(bB){bB()}bt("pauseRecording","Error processing pause recording request",bC)})}else{screenleap.error("pauseRecording","Recording has not been paused for the screen share.",{})}};this.resumeRecording=function(bA,bB){if(l){aY("ru",bA,function(bC){if(bB){bB()}bt("resumeRecording","Error processing resume recording request",bC)})}else{screenleap.error("resumeRecording","Recording has not been resumed for the screen share.",{})}};this.stopRecording=function(bA,bB){if(l){if(bB){bB()}aY("rp",bA,function(bC){bt("stopRecording","Error processing stop recording request",bC)})}else{screenleap.error("stopRecording","Recording has not been enabled for the screen share.",{})}};var aY=function(bC,bA,bB){aq.log("Send call via app server: "+bC);D("sendApiCallViaAppServer:"+bC,{url:ai+"/"+bC,type:"GET",success:function(bD){if(typeof bA=="function"){bA(bD)}},error:function(bD){if(typeof bB=="function"){bB(bD)}}})};this.endScreenShare=function(bB){if(F){if(V=="APPLET"){R().innerHTML=""}if(aJ=="stage"){aP("End of screen share on staging")}if(bB){this.onScreenShareEnd(bB.message)}else{this.onScreenShareEnd()}O();aO();w=[];var bA=document.getElementById("hiddenDownloader");if(bA){document.body.removeChild(bA)}}};this.downloadNativeApp=function(bA,bC,bB){O();if(typeof bA!="function"){bt("downloadNativeApp","You need to pass in onAppDownloadEnd callback function");return}if(!aj()){return}bx=bA;bo(bC);if(bB){this.setOptions(bB)}H();Z=true};this.startNativeApp=function(bB,bA){by(bB);bo(bA);V="NATIVE";k(bB)};this.checkIsAuthenticatedToExtension=function(){ba("checkIsAuthenticated")};this.signInToExtension=function(bB,bA){ba("authenticate",{emailAddress:bB,password:bA})};this.startNewShare=function(bB,bC){var bA=window.location.hostname;if(bA.indexOf(".")==-1||bA.substr(bA.indexOf(".")+1).indexOf("screenleap.com")!=0){this.error("This is for internal use only")}else{V="EXTENSION";ba("newShare",{origin:bB,isCaptureEntireScreen:bC});u()}};this.startNewBroadcast=function(bB,bC){var bA=window.location.hostname;if(bA.indexOf(".")==-1||bA.substr(bA.indexOf(".")+1).indexOf("screenleap.com")!=0){this.error("This is for internal use only")}else{V="EXTENSION";ba("newBroadcast",{origin:bB,isCaptureEntireScreen:bC});u()}};var by=function(bA){p=bA;F=bA.screenShareCode;aX=bA.participantId;a9=bA.isRequestingToBePresenter;aq.log("Extract data for share "+F);U=bA.viewerUrl;a6=bA.origin;ai=bA.browserMessageUrl;if(typeof bA.serverEnv!="undefined"){aJ=bA.serverEnv}l=bA.recordingId};var R=function(){var bA=document.getElementById("screenleapDiv");if(!bA){bA=document.createElement("div");bA.id="screenleapDiv";bA.setAttribute("style","position:fixed;right:1px;bottom:1px;visibility:hidden;width:1px;height:1px");document.body.appendChild(bA)}return bA};var o=function(){return document.getElementById("screenleapDiv")};var aU=function(bA){if(aJ=="stage"){aq.log(bA)}};var a3=function(bA,bB){if(!V){if(typeof bB=="function"){bB()}}else{if(V=="EXTENSION"){bt("statusCheck","This check is not valid for extension shares.")}else{if(V=="NATIVE"||V=="APPLET"){D("checkIsShareActive",{url:h()+"/status"+(F?"/"+F:""),type:"GET",success:function(bC,bD){bq();if(typeof bA=="function"){bA(bC,bD)}},error:function(bD){var bC=false;if(F&&bD){if(bD.status==410){bC=true;aU("got 410 during _doShareStatusCheckByLocalCommunication");screenleap.endScreenShare({message:"LOCKED"})}else{if(bD.status==400){bC=true;aq.log("checkIsShareActive","Screen share "+F+" is not running.")}}}if(!bC&&bv&&c){aq.log("Local status check failed - but without any informative status, and app server connection is active")}if(typeof bB=="function"){bB(bD)}else{aq.log("checkIsShareActive","Error checking app for status",bD)}}})}}}};var bl=function(bA,bB){aq.log("Send stop message to native");if(a){aY(bB?"sa":"sp",null,function(bC){bt("stop","Error processing stop request",bC)})}else{D("stop",{url:h()+"/stop/"+F,type:"POST",success:function(bC){aq.log("Send successful stop message: "+bC)},error:function(){aq.log("Stopping share via app server because failed to do so via local web server");aY(bB?"sa":"sp",null,function(bC){if(bC&&bC.status&&bC.status!=400&&bC.status!=403&&bC.status!=410){bt("stop","Error processing stop request as backup to local stop",bC)}screenleap.endScreenShare()})}})}};var Y=function(bA){if(screenleap.getUseCustomProtocol()){n(a6=="API"?screenleap.COOKIE_API_APP_INSTALLED:screenleap.COOKIE_APP_INSTALLED,true,365,location.hostname);Z=true;n(screenleap.COOKIE_FORCE_NEW_INSTALLATION,"",0,location.hostname);s=true}if(!bv){aq.log("Screen share started");bv=new Date().getTime();screenleap.onScreenShareStart(bA);if(screenleap.getUseCustomProtocol()){ag()}}};var k=function(bA){aq.log("Send start message to presenter app");if(aH){aH()}setTimeout(function(){var bB="/start?presenterParams="+bA.presenterParams;if(bd){bB+="&startingWindowTitle="+bd}T(new Date().getTime());bs(bB,ak)},az)};var v=function(bA){window.location.href=bA};var a4=function(bC,bA){var bB=document.getElementById(bC);if(!bB){bB=document.createElement("iframe");bB.id=bC;bB.style.display="none";document.body.appendChild(bB)}bB.src=bA};var r=function(bA){if(screenleap.isMSIE8||screenleap.isActiveXFilteringEnabled()){window.location.href=bA}else{a4("hiddenDownloader",bA)}};var H=function(bA){aq.log("Download native app");if(aE){aE(screenleap.startAppUsingCustomProtocolHandler)}if(aV&&!screenleap.useClickOnce()&&!screenleap.isMSIE8){setTimeout(function(){bn(bA)},aV)}else{bn(bA)}};var bn=function(bA){if(!screenleap.isMSIE8||screenleap.useClickOnce()||!bA||am){r(aD()+t(bA))}am=false;if(screenleap.isMSIE8&&!bA&&bx){bx()}else{if(screenleap.getUseCustomProtocol()&&bA){if(!a){if(a5()){x("/quit",null,function(){aY("sp")})}k(bA)}}else{if(screenleap.useClickOnce()&&bA){bj()}else{I(bx)}}}};var I=function(bA){if(!a){bs("/status",function(){bq();if(bA){bA()}})}else{aq.log("No local communication alternative for listening for app start.")}};var bf=function(bA){if(!a){aq.log(bA+": bypass local communication")}a=true};var bq=function(){if(!aM){aq.log("Successfully connected to local web server")}aM=new Date().getTime();aT(aM);if(aw){aw=null}};var ax=function(){return ar&&aM?new Date().getTime()-aM<2000:false};var aF=function(){if(!aN){aq.log("App server communication started")}aN=new Date().getTime();aT(aN);if(aw){aw=null}};var ao=function(){return c&&aN?new Date().getTime()-aN<120000:false};var y=function(){return aN};var aT=function(bA){X=bA?bA:new Date().getTime()};var bw=function(){return X?(new Date().getTime()-X)/1000:0};var al=function(){return aw?(new Date().getTime()-aw)/1000:0};var at=function(){if(aJ=="dev"||aJ=="stage"){return"_"+aJ}else{return""}};var t=function(bC){var bB=bC&&bC.origin?bC.origin:a6;if(screenleap.isMac){return"/share/mac?browser=true&origin="+bB+"&isInitialInstallation="+!screenleap.isAppInstalled()+(bC?"&screenShareCode="+bC.screenShareCode:"")}else{if(screenleap.useClickOnce()&&bC){var bA=(bB=="SCREENLEAP"?"Screenleap":"ScreenShare")+(aJ?"_"+aJ.charAt(0).toUpperCase()+aJ.slice(1):"");return"/public/windows/"+bA+"/"+bA+".application?presenterParams="+encodeURIComponent(bC.presenterParams)}else{return"/share/win?origin="+bB+"&clickOnce="+screenleap.useClickOnce()+"&standard="+screenleap.getUseCustomProtocol()+"&isInitialInstallation="+!screenleap.isAppInstalled()+(bC?"&screenShareCode="+bC.screenShareCode:"")}}};var av=function(bA){aq.log("Download and start native app");if(!bA||!bA.alreadyDownloaded){H(bA)}};var E=function(bA){av(bA)};var a2=function(bA){aq.log("Start native app");if(bA.startedFromApp){aq.log("Started by Mac app");bq();T(new Date().getTime());ak()}else{if(a5()){i(bA)}else{if(screenleap.getUseCustomProtocol()&&!ay){Q(function(){bq();k(bA)},function(){if(g){g()}if(screenleap.isAppInstalled()){bh(bA)}else{i(bA)}})}else{if(screenleap.useClickOnce()){E(bA)}else{Q(function(){bq();k(bA)},function(){if(g){g()}E(bA)})}}}}};var aj=function(){if(!screenleap.isBrowserSupportedForNative()){screenleap.error("startSharing","This browser is not supported for the native sharing app.",{message:"BROWSER_NOT_SUPPORTED"});return false}else{if(!screenleap.isOSSupportedForNative()){screenleap.error("startSharing","This OS is not supported for the native sharing app.",{message:"OS_NOT_SUPPORTED"});return false}}return true};var Q=function(bA,bB){aq.log("Attempting to start using local web server...");D("checkIsNativeAppRunning",{url:h()+"/status",type:"POST",success:bA,error:bB})};var h=function(){if(!aB){var bA=screenleap.isMac||window.location.protocol=="https:";aB=(bA?"https:":"http:")+"//0111001101101100.com:"+(bA?"5327":"5322")}return aB};var ae=function(bB,bA,bC){return(a6=="API"?"screenshare":"screenleap")+(aJ&&screenleap.isWin?aJ:"")+(screenleap.isSafari?"://":":")+bB+(bA?"?p="+bA:"")+(bC?"&r=true":"")};var an=function(){return window.location.host.indexOf("screenleap.com")!=-1};var aD=function(){return aA?aA:af()};var af=function(){return an()?"":window.location.protocol+"//"+(aJ=="stage"?"stage":"www")+".screenleap.com"};var aQ=function(bC,bB){aq.log(bB+": Process "+bC);try{var bE=JSON.parse(bC);for(var bA=0;bA<bE.length;bA++){if(F){aS(bE[bA])}}}catch(bD){}};var aS=function(bB){switch(bB.type){case"ss":Y(bB);break;case"sc":if(!z){Y(bB);z=new Date().getTime();screenleap.onPresenterConnect(bB)}break;case"se":if(bB.message&&bB.message=="LOST_CONNECTION"){aP("RECEIVED LOST_CONNECTION FROM POLLING RESPONSE");aU("RECEIVED LOST_CONNECTION FROM POLLING RESPONSE")}else{aU("_processResponse got se")}x("/ack-se/"+F);screenleap.endScreenShare(bB);break;case"cn":screenleap.onViewerConnect(bB.participantId,bB.externalId,bB.useWebRTC);break;case"dn":screenleap.onViewerDisconnect(bB.participantId,bB.externalId,bB.useWebRTC);break;case"sp":screenleap.onPause();break;case"sr":screenleap.onResume();break;case"sa":var bA=(ai.charAt(4)=="s"?"https://":"http://")+bB.hostname+ai.substring(ai.indexOf("/",ai.indexOf("screenleap.com")));aq.log("Switching app servers to "+bA);ai=bA;if(br){br(bA)}break;default:if(an()&&typeof screenleap.processResponse=="function"){screenleap.processResponse(bB)}break}};var e=function(bA){return bA=="EXTENSION"||bA=="NATIVE"||bA=="APPLET"};var ba=function(bD,bB){if(bB){bB.action=bD}else{bB={action:bD}}if(!bB.origin){bB.origin=a6}var bC=R();if(bC){var bA=document.createEvent("CustomEvent");bA.initCustomEvent("screenleapTrigger",true,true,bB);bC.dispatchEvent(bA)}};this.processWebPageMessage=function(bA){aS(bA);return true};var bi=function(bB){var bA=bB.detail;if(bA){switch(bA.event){case"screenShareStarted":screenleap.onScreenShareStart(bA);break;case"screenShareStartFailed":screenleap.error("startSharing","Unable to start share",{status:bA.status});break;case"webPageMessage":screenleap.processWebPageMessage(bA);break;case"viewerConnected":screenleap.onViewerConnect(bA.participantId,bA.externalId);break;case"viewerDisconnected":screenleap.onViewerDisconnect(bA.participantId,bA.externalId);break;case"screenShareStopped":screenleap.endScreenShare(bA);break;case"screenShareEnd":screenleap.onScreenShareEnd();break;default:aq.log("unknown message from extension: "+bA.event)}}};var u=function(){if(V=="EXTENSION"){var bA=o();if(bA){bA.addEventListener("screenleapExtensionEvent",bi)}}};var aO=function(){if(V=="EXTENSION"){var bA=o();if(bA){bA.removeEventListener("screenleapExtensionEvent",bi)}}};var x=function(bD,bA,bB,bE,bC){D("sendMessageToNativeApp",{url:h()+bD,type:"POST",params:bE,responseType:bC,success:function(bF,bG){bq();if(typeof bA=="function"){bA(bF,bG)}},error:function(bF){if(typeof bB=="function"){bB(bF)}}})};var bs=function(bB,bA,bC){if(!bC){bC=0}x(bB,bA,function(bD){if(!F){return}if(bD&&bD.status==409){aU("Conflict 409");screenleap.endScreenShare({message:"CONFLICT"})}else{if(bD&&bD.status==400){aU("Conflict 400");screenleap.endScreenShare({message:"CONFLICT"})}else{setTimeout(function(){bs(bB,bA,++bC)},az)}}})};var bk=function(bA,bB){if(V=="EXTENSION"){ba("sendMessageFromWebPage",{message:"cl"});bA()}else{if(a){aY("cl",bA,bB)}else{x("/copy-link",bA,function(){aY("cl",bA,bB)})}}};var K=function(bA,bB){if(V=="EXTENSION"){ba("sendMessageFromWebPage",{message:"cs"});bA()}else{if(a){aY("cs",bA,bB)}else{x("/copy-share-code",bA,function(){aY("cs",bA,bB)})}}};var ah=function(bB,bA,bC){if(V=="EXTENSION"){ba("sendMessageFromWebPage",{message:"cc|"+bB});bA()}else{if(a){aY("cc|"+bB,bA,bC)}else{x("/copy-instructions/"+bB,bA,function(){aY("cc|"+bB,bA,bC)})}}};var b=function(bA,bB){if(a){aY("we",bA,bB)}else{x("/webrtc-enable",bA,function(){aY("we",bA,bB)})}};var C=function(bA,bB){if(a){aY("wd",bA,bB)}else{x("/webrtc-disable",bA,function(){aY("wd",bA,bB)})}};var a1=function(bC,bA,bB){if(a){aY("wd",bA,bB)}else{x("/frame",bA,function(){aY("wd",bA,bB)},bC,"arraybuffer")}};var au=function(bA,bB){if(a){aY("wd",bA,bB)}else{x("/force-send",bA,function(){aY("wd",bA,bB)})}};var be=function(bA){if(!bA){return false}else{bA=""+bA;bA=bA.replace(/ /g,"");return bA&&bA.length==9&&/^[0-9]+$/.test(bA)}};var aI=function(){return"withCredentials" in new XMLHttpRequest()};var D=function(bD,bC){var bF;if(bC.params){bC.url+="?";for(var bA in bC.params){bC.url+=bA+"="+encodeURIComponent(bC.params[bA])+"&"}bC.url=bC.url.slice(0,bC.url.length-1)}if(!bC.type){bC.type="GET"}if(bC.type=="GET"){bC.url+=(bC.url.indexOf("?")==-1?"?ts=":"&ts=")+new Date().getTime()}if(aI()){try{bF=new XMLHttpRequest();bF.open(bC.type,bC.url,true);bF.timeout=bC.timeout?bC.timeout:bz;if(bC.responseType){bF.responseType=bC.responseType}if(bC.data){bF.setRequestHeader("Content-type",bC.contentType||"application/x-www-form-urlencoded")}if(bC.headers){for(var bB in bC.headers){bF.setRequestHeader(bB,bC.headers[bB])}}bF.onreadystatechange=function(){if(bF.readyState==4){if(bF.status==200){if(bC.success){bC.success(bF.responseType?null:bF.responseText,bF)}}else{if(bC.error){bC.error(bF)}}bF=null}};bF.send(bC.data?bC.data:null)}catch(bE){bt(bD,"Encountered exception while calling send for url "+bC.url+": "+bE);if(bC.error){bC.error()}}}else{if(typeof XDomainRequest!="undefined"){try{bC.url+=(bC.url.indexOf("?")==-1?"?":"&")+"returnOkWithStatus=true";bF=new XDomainRequest();bF.open(bC.type,bC.url);bF.onload=function(){if(bF.responseText){var bG;try{bG=JSON.parse(bF.responseText)}catch(bH){aq.log(bD+": failed to parse response "+bF.responseText)}if(bG&&bG.status&&bG.status!=200){if(bC.error){bC.error({status:bG.status,reason:bG.reason})}bF=null;return}}if(bC.success){bC.success(bF.responseText)}bF=null};bF.onerror=function(){if(bC.error){bC.error()}bF=null};bF.ontimeout=function(){if(bC.error){bC.error()}bF=null};bF.onprogress=function(){};bF.timeout=bC.timeout?bC.timeout:bz;setTimeout(function(){bF.send(bC.data)},0)}catch(bE){bt(bD,"Encountered exception while calling send for url "+bC.url+": "+bE);if(bC.error){bC.error()}}}}};var ad=function(bB,bC,bA){if(aC){if(aC==bB){if(aR!=bC){bt(bB,"This action is already running. Try reloading the page for a fresh state.")}}else{bt(bB,"Unable to run this action at the same time as "+aC)}}else{aC=bB;aR=bC;ar=bA?bA:false;aq.log("Started poll "+aR+":"+aC)}};var M=function(bA){if(!bA||aC==bA||aR==bA){aq.log("Stopped poll"+(aR?" "+aR+":"+aC:""));aC="";aR=""}else{if(aR||aC){aq.log(bA+": Ignoring request to end poll because current poll is "+aR+":"+aC)}}};var bu=function(){M();ar=false;c=""};var ac=function(bA){if(ar&&a){M(bA);aq.log("Bypassing local communication - turn off poll "+aC)}return aR==bA};var bc=function(bA,bB){var bC=new Date().getTime();ad("waitForExtensionInstallation",bC);bp(bA,bB,bC)};var bp=function(bA,bB,bC){if(ac(bC)){setTimeout(function(){screenleap.checkIsExtensionInstalled(function(){M(bC);if(typeof bA=="function"){bA()}},function(){setTimeout(function(){bp(bA,bB,bC)},500)})},1000)}else{if(typeof bB=="function"){bB("Aborted waiting for extension installation.")}}};var bj=function(){if("EXTENSION"==V){aq.log("ERROR: _waitForShareShareStart should not be called for extensions");return}aq.log("Start polling for share start");if(!aw){aw=new Date().getTime()}T(new Date().getTime());if(!a&&!bv){var bA=new Date().getTime();ad("waitForShareStart",bA,true);aa(bA)}};var aa=function(bA){if(ac(bA)){a3(function(bB){M(bA);if(bB){aQ(bB,"_pollForShareStartByLocalCommunication")}if(F){aq.log("Poll for share start successful");T(new Date().getTime());ak()}},function(bB){setTimeout(function(){if(bB&&bB.status==400){M(bA)}else{aa(bA)}},1000)})}};var ak=function(){Y();aq.log("Start polling for share end");if(!a){M("waitForShareStart");ad("waitForShareEnd",F,true);S(F)}};var S=function(bA){if(ac(bA)){a3(function(bC){var bB=false;bq();if(bC){aq.log("Received message: "+bC);bB=aQ(bC,"_pollForShareEndByLocalCommunication")}if(!bB&&F){setTimeout(function(){S(bA)},1000)}else{aq.log("Share ended; stop polling");M(bA)}},function(bB){if(bB&&(bB.status==404||bB.status==400)){M(bA);aU("_pollForShareEndByLocalCommunication got "+bB.status+", so stopping share.");screenleap.endScreenShare()}else{if(bw()>30){aq.log("Lost local connection over 30s ago; switch to app server polling.");M(bA);bf("_pollForShareEndByLocalCommunication")}else{if(!a){aq.log("Lost local connection");setTimeout(function(){S(bA)},1000)}else{aq.log("Ignoring failed local poll because bypass is active.")}}}})}else{aq.log("Stop polling local webserver for share end; poll cancelled")}};var bh=function(bA){aq.log("using custom protocol handler");ay=new Date().getTime();aG(bA,true)};var N=function(bC,bB,bD){var bA=ae(bC,bB,bD);aq.log("Attempting to start app using custom protocol handler...");if(aH){aH()}if(screenleap.isMSIE8){setTimeout(function(){window.location.assign(bA)},500)}else{if(screenleap.isChrome){window.location.assign(bA)}else{ag();a4("screenleapCustomProtocol",bA)}}};var ag=function(){if(document.getElementById("screenleapCustomProtocol")){document.body.removeChild(document.getElementById("screenleapCustomProtocol"));return true}return false};var aG=function(bB,bA){aq.log("pollForCustomProtocolHandlerStart");bj();if(!screenleap.isScreenShareStarted()&&!screenleap.isScreenShareStopped()){if(am){i(bB)}else{if(!screenleap.isAppInstalled()&&bA){i(bB)}else{N(bB.screenShareCode,bB.participantId,bB.isRequestingToBePresenter);setTimeout(function(){if(!bv&&j){j()}},aK)}}}};var i=function(bA){av(bA);if(G!=screenleap.DISABLE_CUSTOM_PROTOCOL_AUTO_START){setTimeout(function(){aG(bA,false)},G)}};var a0=function(){return bv?new Date().getTime()-bv:0};var T=function(bB,bA){if(!F||!ai){return}if(a||!ax()){if(!c||c==bB){if(!c){c=bB;aq.log("Start polling app server: "+c)}bm(function(bC){aF();if(!ax()){aQ(bC,"_pollAppServerForMessages")}if(!a&&!L()){if(a0()>500){bf("_pollAppServerForMessages")}}setTimeout(function(){T(bB)},1000)},function(bD){if(bD&&bD.status=="400"){setTimeout(function(){T(bB)},1000)}else{if(bD&&bD.status=="404"){setTimeout(function(){T(bB)},1000)}else{if(bD&&bD.status=="410"){c="";aq.log("Stop polling app server; share ended");aU("Stop polling app server; share ended");screenleap.endScreenShare({message:"LOCKED"})}else{if(bA){if(bw()>480){aq.log("Connection lost. Ending.");aP("ENDING SHARE DUE TO LOST CONNECTION");var bC=bw();aU("ENDING SHARE DUE TO LOST CONNECTION, seconds since last app message: "+(bC?bC:"never received app message"));screenleap.endScreenShare({message:"LOST_CONNECTION"})}else{if(al()>30&&typeof a7=="function"){a7()}setTimeout(function(){T(bB,bA)},1000)}}else{if(bw()>300){setTimeout(function(){T(bB,true)},1000)}else{setTimeout(function(){T(bB)},1000)}}}}}},bA)}}else{setTimeout(function(){T(bB)},1000)}};var bm=function(bA,bC,bB){D("makeAppServerRequest",{url:ai+(!X||!bv||bB?"?isStart=true":""),type:"GET",timeout:60000,success:function(bD){if(typeof bA=="function"){bA(bD)}},error:function(bD){if(typeof bC=="function"){bC(bD)}}})};var aL=function(){var bB="";var bC=w;w=[];for(var bA=0;bA<bC.length;bA++){bB+=bC[bA]+"\n"}return bB};var aP=function(bA){var bB=m();bB.error=bA;D("emailErrorReport",{url:af()+"/screen-share/log-js-email",params:bB,data:aL(),type:"POST"})};var m=function(){return{userAgent:W,presenterAppType:V,localCommunicationActive:ax(),appServerPollingStarted:y(),localShareStartTime:bv,presenterConnectTime:z,lastAppMessageTimestamp:X,screenShareCode:F,participantId:aX,isRequestingToBePresenter:a9,serverEnv:aJ,pollingAction:aC,appServerPollId:c,useClickOnce:screenleap.useClickOnce(),isMac:screenleap.isMac,isWin:screenleap.isWin}};var a8=function(){var bA=new Date();var bB=(bA).toTimeString();return bA.getFullYear()+"-"+bA.getMonth()+"-"+bA.getDate()+" "+bB.substring(0,bB.lastIndexOf(":")+3)+":"+bA.getMilliseconds()};var aZ=[];var bt=function(bF,bE,bD){var bB=bF+bE;var bA=false;for(var bC=0;bC<aZ.length;bC++){if(aZ[bC]==bB){bA=true;break}}if(!bA){aP(bF+": "+bE+(bD&&bD.message?" - "+bD.message:"")+(bD&&bD.status?"; status code "+bD.status:""));aZ.push(bB)}screenleap.error(bF,bE,bD)};var n=function(bC,bF,bA,bD){var bB="";if(bA){var bE=new Date();bE.setTime(bE.getTime()+(bA*24*60*60*1000));bB="expires="+bE.toUTCString()}document.cookie=bC+"="+bF+(bB?"; "+bB:"")+(bD?"; domain="+bD+"; path=/":"")};var ap=function B(bC){var bB=bC+"=";var bA=document.cookie.split(";");for(var bD=0;bD<bA.length;bD++){var bE=bA[bD];while(bE.charAt(0)==" "){bE=bE.substring(1)}if(bE.indexOf(bB)!=-1){return bE.substring(bB.length,bE.length)}}return""}}var screenleap=screenleap||new Screenleap();var screenleapShareCodeFieldAllowHandle=true;function screenleapShareCodeFieldKeyUp(d,c){if(typeof isAndroid!="undefined"&&isAndroid){return true}d=d?d:window.event;var a=window.event?d.keyCode:d.which;if(!d.ctrlKey&&!d.altKey&&!d.shiftKey&&(a>=33&&a<=40)){return true}if(c.value.length>0){var b=/^[0-9 ]+$/.test(c.value);if(d.keyCode==8){while(c.value.length>0&&c.value.charAt(c.value.length-1)==" "){c.value=c.value.substring(0,c.value.length-1)}return true}else{if(d.keyCode==13&&((screenleapShareCodeFieldAllowHandle&&!b)||c.value.length==13)){return true}}c.value=formatScreenleapShareCode(c.value)}return false}function formatScreenleapShareCode(e,f){var b=[];var d=0;if(!f){f=getScreenleapShareCodeSeparator(e)}if(!screenleapShareCodeFieldAllowHandle){e=e.replace(/\D/g,"")}var a=/^[0-9 ]+$/.test(e);if(a){for(var c=0;c<e.length;c++){if(e.charAt(c)!=" "){b.push(e.charAt(c));d++;if(d>0&&d<9&&d%3==0){b.push(f)}else{if(d==9){break}}}}var g=b.join("");if(e!=g){return g}}return e}function getScreenleapShareCodeSeparator(c){var d="";var b=false;for(var a=0;a<c.length;a++){if(c.charAt(a)==" "){b=true;d+=" "}else{if(b){return d}}}return d==""?"  ":d};